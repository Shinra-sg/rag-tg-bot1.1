# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º —Å –∫–Ω–æ–ø–∫–∞–º–∏

## üêõ –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ –∫–Ω–æ–ø–∫–∏ –ø–æ—Å–ª–µ –æ—Ç–≤–µ—Ç–∞ –±–æ—Ç–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–∞ **–≤–µ—á–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞** (–∫–Ω–æ–ø–∫–∞ –æ—Å—Ç–∞–≤–∞–ª–∞—Å—å –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ "–∑–∞–≥—Ä—É–∑–∫–∏").

## üîç –ü—Ä–∏—á–∏–Ω—ã

1. **–ù–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏** –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞—Ö –∫–Ω–æ–ø–æ–∫
2. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ `ctx.answerCbQuery()`** –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
3. **–ü—Ä–æ–±–ª–µ–º—ã —Å Markdown –ø–∞—Ä—Å–∏–Ω–≥–æ–º** –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ "–ü–æ–∫–∞–∑–∞—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫–∏"
4. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ fallback –º–µ—Ö–∞–Ω–∏–∑–º–æ–≤**

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### 1. **–î–æ–±–∞–≤–ª–µ–Ω—ã try-catch –±–ª–æ–∫–∏**

–í—Å–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫ —Ç–µ–ø–µ—Ä—å –æ–±–µ—Ä–Ω—É—Ç—ã –≤ try-catch:

```typescript
bot.action("show_sources", async (ctx) => {
  try {
    await ctx.answerCbQuery();
    // ... –ª–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏
  } catch (error) {
    console.error("Error in show_sources handler:", error);
    try {
      await ctx.answerCbQuery("‚ùå –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∫–∞–∑–µ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤");
    } catch (e) {
      console.error("Failed to answer callback query:", e);
    }
  }
});
```

### 2. **–ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç –Ω–∞ callback**

–î–∞–∂–µ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö `ctx.answerCbQuery()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º –æ–± –æ—à–∏–±–∫–µ:

```typescript
await ctx.answerCbQuery("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∑–∞–ø—Ä–æ—Å–∞");
```

### 3. **–£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ Markdown**

–í –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ "–ü–æ–∫–∞–∑–∞—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫–∏" –¥–æ–±–∞–≤–ª–µ–Ω fallback:

```typescript
try {
  const formattedSources = formatSearchResults(results);
  await ctx.reply(formattedSources, { parse_mode: 'Markdown' });
} catch (error) {
  console.log("Markdown parsing error, using plain format:", error);
  const formattedSources = formatSearchResultsPlain(results);
  await ctx.reply(formattedSources);
}
```

### 4. **–î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**

–§—É–Ω–∫—Ü–∏—è `logAction()` –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏–π:

```typescript
function logAction(action: string, userId?: number, details?: any) {
  console.log(`[${new Date().toISOString()}] Action: ${action}, User: ${userId}, Details:`, details);
}
```

## üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏

### `ask_question`
- ‚úÖ Try-catch –±–ª–æ–∫
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏–π
- ‚úÖ Fallback –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

### `help`
- ‚úÖ Try-catch –±–ª–æ–∫
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏–π
- ‚úÖ Fallback –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

### `about`
- ‚úÖ Try-catch –±–ª–æ–∫
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏–π
- ‚úÖ Fallback –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

### `show_sources`
- ‚úÖ Try-catch –±–ª–æ–∫
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏–π
- ‚úÖ Fallback –Ω–∞ plain —Ñ–æ—Ä–º–∞—Ç
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### `download_*`
- ‚úÖ Try-catch –±–ª–æ–∫
- ‚úÖ –£–ª—É—á—à–µ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
- ‚úÖ Fallback –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
- ‚ùå –í–µ—á–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∫–Ω–æ–ø–æ–∫
- ‚ùå –ù–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
- ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
- ‚ùå –ü–∞–¥–µ–Ω–∏–µ –±–æ—Ç–∞ –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
- ‚úÖ –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç –Ω–∞ –Ω–∞–∂–∞—Ç–∏—è
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö –æ—à–∏–±–æ–∫
- ‚úÖ –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ Graceful degradation
- ‚úÖ –ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

- **–û–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:** 5
- **Try-catch –±–ª–æ–∫–æ–≤ –¥–æ–±–∞–≤–ª–µ–Ω–æ:** 5
- **Fallback –º–µ—Ö–∞–Ω–∏–∑–º–æ–≤:** 3
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ:** –î–∞

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –û–±—ã—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞:
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É
2. –ë–æ—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ callback
3. –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–µ–π—Å—Ç–≤–∏–µ
4. –ü—Ä–∏ –æ—à–∏–±–∫–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ

### –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:
- –í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å
- –û—à–∏–±–∫–∏ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è —Å –¥–µ—Ç–∞–ª—è–º–∏
- –ú–æ–∂–Ω–æ –æ—Ç—Å–ª–µ–¥–∏—Ç—å –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ –º–µ—Å—Ç–∞

**–¢–µ–ø–µ—Ä—å –∫–Ω–æ–ø–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ –∏ –º–≥–Ω–æ–≤–µ–Ω–Ω–æ!** üéâ 